<!DOCTYPE html>
<html>
  <head>
    <title>Asynchronous Loading</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>

    <script>

var map; 
var gyms = {
	"gyms": [
		{
			"name": "Princeton Club - West",
			"lat": 43.054723, 
			"lng": -89.519298
		}, 
		{
			"name": "Planet Fitness",
			"lat": 43.058620, 
			"lng": -89.512261
		},
		{
			"name": "9Round Kickboxing Fitness - Madison West",
			"lat": 43.061463, 
			"lng": -89.496102
		},
    {
      "name": "Madison Body Fitness",
      "lat": 43.049550, 
      "lng": -89.475592
    },
    {
      "name": "Orange Shoe Personal Fitness",
      "lat": 43.073237, 
      "lng": -89.524984
    },
    {
      "name": "Fourier Fitness",
      "lat": 43.080256, 
      "lng": -89.523207
    },
    {
      "name": "SwimWest Swim School",
      "lat": 43.080607, 
      "lng": -89.534024
    },
    {
      "name": "Anytime Fitness",
      "lat": 43.084225, 
      "lng": -89.501501
    },
    {
      "name": "Madtown Twisters Gymnastics - West",
      "lat": 43.074678, 
      "lng": -89.503579
    },
    {
      "name": "Madtown Twisters Gymnastics - West",
      "lat": 43.053465, 
      "lng": -89.486145
    },
    {
      "name": "Fit Body Boot Camp Madison",
      "lat": 43.050022, 
      "lng": -89.478105
    },
    {
      "name": "Fit Body Boot Camp Madison",
      "lat": 43.096592, 
      "lng": -89.542663
    },
    {
      "name": "Body Mechanix",
      "lat": 43.095558, 
      "lng": -89.516100
    },
    {
      "name": "The Little Gym of Middleton",
      "lat": 43.096044, 
      "lng": -89.514023
    },
    {
      "name": "Cross Fit Madtown",
      "lat": 43.106060, 
      "lng": -89.527115
    },
    {
      "name": "Princeton Club Xpress",
      "lat": 43.101002, 
      "lng": -89.486413
    },
    {
      "name": "Snap Fitness Madison West",
      "lat": 43.076773, 
      "lng": -89.468470
    },
    {
      "name": "Anytime Fitness",
      "lat": 43.017804, 
      "lng": -89.423339
    },
    {
      "name": "Gold's Gym",
      "lat": 43.013349, 
      "lng": -89.477204
    },
    {
      "name": "Orange Shoe Personal Fitness",
      "lat": 43.013001, 
      "lng": -89.474885
    },
    {
      "name": "Anytime Fitness",
      "lat": 43.010810, 
      "lng": -89.478586
    },
    {
      "name": "Gymfinity",
      "lat": 43.008803, 
      "lng": -89.483032
    },
    {
      "name": "UW SERF",
      "lat": 43.070864, 
      "lng": -89.398414
    },
    {
      "name": "iGO Fitness",
      "lat": 43.074891, 
      "lng": -89.388273
    },
    {
      "name": "Anytime Fitness",
      "lat": 43.072263, 
      "lng": -89.398844
    },
    {
      "name": "Orange Shoe Personal Fitness",
      "lat": 43.073830, 
      "lng": -89.382421
    },
    {
      "name": "Pat's Gym",
      "lat": 43.082212, 
      "lng": -89.370529
    },
    {
      "name": "Fitness Solutions",
      "lat": 43.073145, 
      "lng": -89.434402
    },
    {
      "name": "Monkey Bar Gym",
      "lat": 43.091835, 
      "lng": -89.360100
    },
    {
      "name": "Twisted Fitness",
      "lat": 43.094421, 
      "lng": -89.353685
    },
    {
      "name": "Snap Fitness Madison",
      "lat": 43.092144, 
      "lng": -89.353532
    },
    {
      "name": "Badger Fitness",
      "lat": 43.068088, 
      "lng": -89.310603
    },
    {
      "name": "CrossFit Sanctify",
      "lat": 43.066767, 
      "lng": -89.305353
    },
    {
      "name": "Fun Function Fitness",
      "lat": 43.051288, 
      "lng": -89.305296
    },
    {
      "name": "Curves",
      "lat": 43.050351, 
      "lng": -89.324384
    },
    {
      "name": "Anytime Fitness",
      "lat": 43.053759, 
      "lng": -89.324725
    },
    {
      "name": "Planet Fitness",
      "lat": 43.044928, 
      "lng": -89.350933
    }
	] 
};

gyms.display = function() {
	for (gym in gyms.gyms) {
		var latLng = new google.maps.LatLng(gyms.gyms[gym].lat, gyms.gyms[gym].lng);
		var marker = new google.maps.Marker({
		    position: latLng,
		    map: map,
		    title: gyms.gyms[gym].name
		});
	}
}

function initialize() {
  var mapOptions = {
    zoom: 12,
    center: new google.maps.LatLng(43.074399, -89.436479)
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  gyms.display();
}

function loadScript() {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp' +
      '&signed_in=true&callback=initialize';
  document.body.appendChild(script);
}

window.onload = loadScript;

    </script>

  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>